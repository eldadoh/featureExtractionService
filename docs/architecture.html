<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature Detection API - Architecture</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 { text-align: center; color: #667eea; margin-bottom: 40px; font-size: 2.5em; }
        h2 { color: #764ba2; margin-top: 40px; margin-bottom: 20px; border-bottom: 3px solid #667eea; padding-bottom: 10px; }
        .architecture-diagram { background: #f8f9fa; padding: 30px; border-radius: 8px; margin: 20px 0; overflow-x: auto; }
        .component { background: white; border: 2px solid #667eea; border-radius: 8px; padding: 20px; margin: 10px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .component h3 { color: #667eea; margin-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        th { background: #667eea; color: white; padding: 15px; text-align: left; font-weight: 600; }
        td { padding: 12px 15px; border-bottom: 1px solid #ddd; }
        tr:hover { background: #f8f9fa; }
        .flow-diagram { background: white; border: 2px solid #764ba2; border-radius: 8px; padding: 20px; margin: 20px 0; }
        .flow-step { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; margin: 10px 0; border-radius: 5px; position: relative; }
        .flow-step::before { content: 'â–¼'; position: absolute; left: 50%; bottom: -20px; transform: translateX(-50%); font-size: 20px; color: #764ba2; }
        .flow-step:last-child::before { content: ''; }
        .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0; }
        .metric-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .metric-card h3 { font-size: 2.5em; margin-bottom: 10px; }
        .metric-card p { font-size: 1.1em; opacity: 0.9; }
        code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; font-family: 'Courier New', monospace; color: #d63384; }
        pre { background: #2d2d2d; color: #f8f8f2; padding: 20px; border-radius: 8px; overflow-x: auto; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—ï¸ Feature Detection API - System Architecture</h1>
        
        <h2>ğŸ“Š High-Level Architecture</h2>
        <div class="architecture-diagram">
            <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                   CLIENT LAYER                                   â”‚
â”‚                        (Web Apps, Mobile Apps, Services)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚ HTTP/HTTPS
                                     â”‚ REST API
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            FASTAPI APPLICATION LAYER                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   Worker 1   â”‚  â”‚   Worker 2   â”‚  â”‚   Worker 3   â”‚  â”‚   Worker 4   â”‚       â”‚
â”‚  â”‚  (Uvicorn)   â”‚  â”‚  (Uvicorn)   â”‚  â”‚  (Uvicorn)   â”‚  â”‚  (Uvicorn)   â”‚       â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚       â”‚
â”‚  â”‚ â€¢ FastAPI    â”‚  â”‚ â€¢ FastAPI    â”‚  â”‚ â€¢ FastAPI    â”‚  â”‚ â€¢ FastAPI    â”‚       â”‚
â”‚  â”‚ â€¢ Async/Awaitâ”‚  â”‚ â€¢ Async/Awaitâ”‚  â”‚ â€¢ Async/Awaitâ”‚  â”‚ â€¢ Async/Awaitâ”‚       â”‚
â”‚  â”‚ â€¢ Pydantic   â”‚  â”‚ â€¢ Pydantic   â”‚  â”‚ â€¢ Pydantic   â”‚  â”‚ â€¢ Pydantic   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                 â”‚                 â”‚                 â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                 â”‚                 â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                â”‚                â”‚
                    â–¼                â–¼                â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  REDIS CACHE     â”‚ â”‚   FEATURE    â”‚ â”‚  STRUCTURED      â”‚
         â”‚  (Container)     â”‚ â”‚   DETECTOR   â”‚ â”‚  LOGGING         â”‚
         â”‚                  â”‚ â”‚              â”‚ â”‚                  â”‚
         â”‚ â€¢ Results Cache  â”‚ â”‚ â€¢ SIFT       â”‚ â”‚ â€¢ JSON Format    â”‚
         â”‚ â€¢ TTL: 1 hour    â”‚ â”‚ â€¢ Denoising  â”‚ â”‚ â€¢ Correlation ID â”‚
         â”‚ â€¢ LRU Eviction   â”‚ â”‚ â€¢ ThreadPool â”‚ â”‚ â€¢ Docker Logs    â”‚
         â”‚ â€¢ 512MB Max      â”‚ â”‚ â€¢ OpenCV     â”‚ â”‚ â€¢ Metrics        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </pre>
        </div>

        <h2>ğŸ”„ Request Flow</h2>
        <div class="flow-diagram">
            <div class="flow-step">
                <strong>1. Client Upload</strong><br>
                POST /api/v1/features/detect with multipart/form-data
            </div>
            <div class="flow-step">
                <strong>2. Request Validation</strong><br>
                â€¢ Check file extension (jpg, png, bmp, tif, tiff)<br>
                â€¢ Validate file size (max 10MB)<br>
                â€¢ Verify image integrity with PIL
            </div>
            <div class="flow-step">
                <strong>3. Cache Key Generation</strong><br>
                SHA256 hash of image content â†’ "features:abc123..."
            </div>
            <div class="flow-step">
                <strong>4. Cache Lookup</strong><br>
                Redis GET "features:abc123..."<br>
                â€¢ Hit: Return cached result (5-20ms)<br>
                â€¢ Miss: Continue to processing
            </div>
            <div class="flow-step">
                <strong>5. Feature Detection</strong><br>
                â€¢ Apply Non-Local Means Denoising<br>
                â€¢ Convert to grayscale<br>
                â€¢ SIFT keypoint detection<br>
                â€¢ SIFT descriptor computation<br>
                â€¢ Processing time: 300-500ms
            </div>
            <div class="flow-step">
                <strong>6. Cache Storage</strong><br>
                Redis SETEX "features:abc123..." 3600 {result}
            </div>
            <div class="flow-step">
                <strong>7. Response</strong><br>
                Return JSON with keypoints, descriptors, metadata
            </div>
            <div class="flow-step" style="background: #28a745;">
                <strong>8. Cleanup</strong><br>
                Delete temporary uploaded file
            </div>
        </div>

        <h2>ğŸ“ˆ Performance Metrics</h2>
        <div class="metrics">
            <div class="metric-card">
                <h3>5-20ms</h3>
                <p>Cache Hit Latency</p>
            </div>
            <div class="metric-card">
                <h3>300-500ms</h3>
                <p>Cache Miss Latency</p>
            </div>
            <div class="metric-card">
                <h3>100+</h3>
                <p>Requests/Second</p>
            </div>
            <div class="metric-card">
                <h3>99.9%</h3>
                <p>Uptime Target</p>
            </div>
        </div>

        <h2>ğŸ”§ Component Details</h2>
        
        <div class="component">
            <h3>FastAPI Application</h3>
            <p><strong>Purpose:</strong> Async HTTP server for handling API requests</p>
            <p><strong>Technology:</strong> FastAPI + Uvicorn with 4 workers</p>
            <p><strong>Responsibilities:</strong></p>
            <ul>
                <li>Request validation (Pydantic)</li>
                <li>Async request handling</li>
                <li>Error handling and logging</li>
                <li>API documentation (OpenAPI)</li>
                <li>Middleware (CORS, logging, request ID)</li>
            </ul>
            <p><strong>Scaling:</strong> Horizontal (multiple workers/containers)</p>
            <p><strong>Resource Usage:</strong> ~200-300MB RAM per worker</p>
        </div>

        <div class="component">
            <h3>Redis Cache</h3>
            <p><strong>Purpose:</strong> In-memory cache for feature detection results</p>
            <p><strong>Technology:</strong> Redis 7.2 Alpine</p>
            <p><strong>Configuration:</strong></p>
            <ul>
                <li>Max Memory: 512MB (configurable)</li>
                <li>Eviction Policy: allkeys-lru</li>
                <li>Persistence: AOF (appendonly)</li>
                <li>TTL: 3600 seconds (1 hour)</li>
            </ul>
            <p><strong>Scaling:</strong> Vertical (increase memory) or Redis Cluster</p>
            <p><strong>Throughput:</strong> 100,000+ ops/sec</p>
        </div>

        <div class="component">
            <h3>Feature Detector</h3>
            <p><strong>Purpose:</strong> SIFT feature detection with denoising</p>
            <p><strong>Technology:</strong> OpenCV 4.12 + ThreadPoolExecutor</p>
            <p><strong>Process:</strong></p>
            <ol>
                <li>Non-Local Means Denoising (h=10, template=100, search=50)</li>
                <li>Convert to grayscale</li>
                <li>SIFT keypoint detection</li>
                <li>SIFT descriptor computation (128-dim)</li>
            </ol>
            <p><strong>Thread Pool:</strong> 4 workers (CPU-bound operations)</p>
            <p><strong>Warmup Time:</strong> 5 seconds on startup</p>
        </div>

        <h2>ğŸ“Š Data Models</h2>
        <div class="component">
            <h3>Response Model</h3>
            <table>
                <tr>
                    <th>Field</th>
                    <th>Type</th>
                    <th>Example</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>success</code></td>
                    <td>bool</td>
                    <td>true</td>
                    <td>Operation status</td>
                </tr>
                <tr>
                    <td><code>keypoints</code></td>
                    <td>int</td>
                    <td>1247</td>
                    <td>Number of detected keypoints</td>
                </tr>
                <tr>
                    <td><code>descriptors_shape</code></td>
                    <td>tuple[int, int]</td>
                    <td>[1247, 128]</td>
                    <td>Descriptor array shape</td>
                </tr>
                <tr>
                    <td><code>cached</code></td>
                    <td>bool</td>
                    <td>false</td>
                    <td>Whether from cache</td>
                </tr>
                <tr>
                    <td><code>processing_time_ms</code></td>
                    <td>float</td>
                    <td>342.5</td>
                    <td>Total processing time</td>
                </tr>
            </table>
        </div>

        <h2>ğŸš€ Deployment Architecture</h2>
        <div class="architecture-diagram">
            <pre>
Production Deployment (Docker Compose)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Load Balancer (Optional)            â”‚
â”‚              (Nginx / Traefik)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Pod 1   â”‚    â”‚  API Pod 2   â”‚    â”‚  API Pod 3   â”‚
â”‚              â”‚    â”‚              â”‚    â”‚              â”‚
â”‚ â€¢ 4 Workers  â”‚    â”‚ â€¢ 4 Workers  â”‚    â”‚ â€¢ 4 Workers  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  Redis Service   â”‚
                  â”‚                  â”‚
                  â”‚ â€¢ 512MB Memory   â”‚
                  â”‚ â€¢ Persistence    â”‚
                  â”‚ â€¢ AOF enabled    â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </pre>
        </div>

        <h2>ğŸ† SOLID Principles Implementation</h2>
        <div class="component">
            <table>
                <tr>
                    <th>Principle</th>
                    <th>Implementation</th>
                </tr>
                <tr>
                    <td><strong>Single Responsibility</strong></td>
                    <td>Each service has one clear purpose: CacheService, ImageService, FeatureService</td>
                </tr>
                <tr>
                    <td><strong>Open/Closed</strong></td>
                    <td>Custom exception hierarchy allows extending without modifying base</td>
                </tr>
                <tr>
                    <td><strong>Liskov Substitution</strong></td>
                    <td>All exceptions inherit from FeatureDetectionException</td>
                </tr>
                <tr>
                    <td><strong>Interface Segregation</strong></td>
                    <td>Services implement specific interfaces (CacheServiceProtocol)</td>
                </tr>
                <tr>
                    <td><strong>Dependency Inversion</strong></td>
                    <td>FastAPI dependency injection, services depend on abstractions</td>
                </tr>
            </table>
        </div>

    </div>
</body>
</html>

